{
	auto_https off
	admin off
}

http://localhost:8080 {
	root * .
	
	redir / /docs/
	
	handle /docs/* {
		uri strip_prefix /docs
		rewrite * /site/docs{path}.html
		try_files {path} /site/docs/index.html
		
		# Apply templates for HTML files
		templates {
			mime text/html
		}
		file_server
	}
	
	handle /docs {
		rewrite * /site/docs/index.html
		templates {
			mime text/html
		}
		file_server
	}
	
	# Serve raw markdown files for now (temporary)
	handle /docs/markdown/* {
		file_server
	}
	
	handle /style.css {
		rewrite * /site/style.css
		file_server
	}
	
	handle /_pagefind/* {
		rewrite * /site{path}
		file_server
	}
	
	file_server
	
	encode gzip
	
	log {
		output stdout
		format console
		level INFO
	}
	
	header {
		Access-Control-Allow-Origin "*"
		Access-Control-Allow-Methods "GET, POST, OPTIONS"
		Access-Control-Allow-Headers "*"
	}
	
	handle_errors {
		@404 expression {http.error.status_code} == 404
		handle @404 {
			respond "Page not found. Try visiting /docs/ for documentation." 404
		}
	}
}